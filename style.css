const locations = [
  "–ö–∞–∑–∏–Ω–æ",
  "–®–∫–æ–ª–∞",
  "–ü–ª—è–∂",
  "–°–∞–º–æ–ª–µ—Ç",
  "–ë–æ–ª—å–Ω–∏—Ü–∞",
  "–û—Ç–µ–ª—å"
];

let players = [];
let playerCount = 0;
let currentIndex = 0;
let spyIndex = 0;
let location = "";

const startScreen = document.getElementById("startScreen");
const nameScreen = document.getElementById("nameScreen");
const cardScreen = document.getElementById("cardScreen");
const timerScreen = document.getElementById("timerScreen");

const nameTitle = document.getElementById("nameTitle");
const cardTitle = document.getElementById("cardTitle");
const cardText = document.getElementById("cardText");
const timerDiv = document.getElementById("timer");
const sound = document.getElementById("tickSound");

function startGame() {
  playerCount = Number(document.getElementById("playerCount").value);
  if (playerCount < 3) {
    alert("–ú–∏–Ω–∏–º—É–º 3 –∏–≥—Ä–æ–∫–∞");
    return;
  }

  startScreen.classList.add("hidden");
  nameScreen.classList.remove("hidden");

  askName();
}

function askName() {
  nameTitle.innerText = `–ò–≥—Ä–æ–∫ ${currentIndex + 1}, –≤–≤–µ–¥–∏—Ç–µ –∏–º—è`;
  document.getElementById("playerName").value = "";
}

function saveName() {
  const name = document.getElementById("playerName").value.trim();
  if (!name) return;

  players.push({ name });
  currentIndex++;

  if (currentIndex < playerCount) {
    askName();
  } else {
    prepareRoles();
  }
}

function prepareRoles() {
  spyIndex = Math.floor(Math.random() * playerCount);
  location = locations[Math.floor(Math.random() * locations.length)];
  currentIndex = 0;

  nameScreen.classList.add("hidden");
  showCard();
}

function showCard() {
  cardScreen.classList.remove("hidden");

  cardTitle.innerText = players[currentIndex].name;

  if (currentIndex === spyIndex) {
    cardText.innerText = "üïµÔ∏è –í–´ –®–ü–ò–û–ù";
  } else {
    cardText.innerText = "üìç –õ–æ–∫–∞—Ü–∏—è: " + location;
  }
}

function hideCard() {
  cardScreen.classList.add("hidden");
  currentIndex++;

  if (currentIndex < playerCount) {
    showCard();
  } else {
    startTimer();
  }
}

function startTimer() {
  timerScreen.classList.remove("hidden");
  let time = 300;

  const interval = setInterval(() => {
    time--;
    timerDiv.innerText = time;
    sound.play();

    if (time <= 0) {
      clearInterval(interval);
      alert("–í—Ä–µ–º—è –≤—ã—à–ª–æ! –û–±—Å—É–∂–¥–∞–π—Ç–µ –∏ –æ–ø—Ä–µ–¥–µ–ª—è–π—Ç–µ —à–ø–∏–æ–Ω–∞.");
    }
  }, 1000);
}
